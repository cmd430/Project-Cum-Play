<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,viewport-fit=cover'" />
    <meta name="theme-color" content="#ff0000" />
    <meta content="TheShed.red" property="og:title" />
    <meta content="TheShed.red" property="og:description" />
    <link rel="icon" type="image/png" href="/img/favicon.png" />
    <link rel="apple-touch-icon" href="/img/favicon.png" />
    <link rel="stylesheet" href="/css/index.css" />
    <script src="/js/index.js"></script>
    <title>TheShed.red</title>
    <!--
      <script>
        function isValidURL(str) {
          let a  = document.createElement('a')
          a.href = str
          return (a.host && a.host != location.host)
        }
        document.addEventListener('DOMContentLoaded', () => {
          let authBox = document.querySelector('#auth')
          let dropContainer = document.querySelector('.uploadWrapper')
          let fileInput = document.querySelector('input[type=file]')
          let fileSubmit = document.querySelector('input[type=submit]')
          let myUploads = document.querySelector('input[type=button]')
          let autoCopy = document.querySelector('input[type=checkbox]')
          let fileForm = document.querySelector('form')
          let progressBar = document.querySelector('.progress')
          let progressBarFill = document.querySelector('.progress .fill')
          let sendFiles = function (fileData) {
            dropContainer.classList.add('hidden')
            autoCopy.labels[0].classList.add('hidden')
            progressBar.classList.remove('hidden')
            let request = new XMLHttpRequest()
              request.onreadystatechange = () => {
                if (request.readyState === 4) {
                  if (request.status === 200) {
                    let responseJSON = JSON.parse(request.responseText)
                    localStorage.authKey = authBox.value
                    localStorage.authUser = responseJSON.meta.uploaded.by
                    let redirect = `${responseJSON.path}`
                    if (autoCopy.checked) {
                      let copyText = `${responseJSON.path}`
                      if (responseJSON.meta.type === 'file' && responseJSON.meta.mimetype.includes('image')) {
                        copyText = `${responseJSON.directpath}`
                      }
                      navigator.clipboard.writeText(`${copyText}`)
                      .catch(err => {
                        console.error('Could not copy to clipboard: ', err)
                      })
                    }
                    location.href = redirect
                  } else if (request.status !== 200) {
                    //error
                  }
                }
              }
              request.upload.onprogress = e => {
                if (e.lengthComputable) {
                  let percentage = (e.loaded / e.total) * 100
                  progressBar.dataset.label = `${Math.round(percentage)}%`
                  progressBarFill.setAttribute('style', `width: ${percentage}%;`)
                }
              }
              request.onerror = e => {
                console.error(e)
              }
              request.open(fileForm.method, fileForm.action, true)
              request.setRequestHeader('Authorization', authBox.value)
              request.send(fileData)
          }
          if (fileInput.files.length > 0) {
            fileForm.reset()
          }
          if (localStorage.authKey) {
            authBox.value = localStorage.authKey
            authBox.classList.add('hidden')
            myUploads.classList.remove('hidden')
          }
          if (localStorage.autoCopy) {
            if (JSON.parse(localStorage.autoCopy)) {
              autoCopy.checked = localStorage.autoCopy
            }
          } else {
            localStorage.autoCopy = false
          }
          autoCopy.addEventListener('change', e => {
            localStorage.autoCopy = autoCopy.checked
          })
          dropContainer.addEventListener('click', e => {
            if (e.target !== authBox) {
              if (fileInput.files.length == 0) {
                fileInput.click()
              }
            }
          })
          dropContainer.addEventListener('dragover', e => {
            e.preventDefault()
          })
          dropContainer.addEventListener('dragenter', e => {
            e.preventDefault()
          })
          dropContainer.addEventListener('drop', e => {
            fileInput.files = e.dataTransfer.files
            e.preventDefault()
          })
          fileInput.addEventListener('change', e => {
            fileSubmit.click()
          })
          fileForm.addEventListener('submit', e => {
            e.preventDefault()
            if (fileInput.files.length > 0) {
              sendFiles(new FormData(e.target))
            }
          })
          myUploads.addEventListener('click', e => {
            location.href = `${location.protocol}//${location.host}/u/${localStorage.authUser}`
          })
          window.addEventListener('paste', e => {
            if (progressBar.classList.contains('hidden')) {
              let clipboardItems = e.clipboardData.items
              let blobs = []
              for (clipboardIndex in clipboardItems) {
                let clipboardItem = clipboardItems[clipboardIndex]
                if (clipboardItem.kind == 'file') {
                  if (clipboardItem.type.includes('image') || clipboardItem.type.includes('video') || clipboardItem.type.includes('audio')) {
                    blobs.push(clipboardItem.getAsFile())
                  }
                } else if (clipboardItem.kind == 'string' && clipboardItem.type == 'text/plain') {
                  clipboardItem.getAsString(text => {
                    if (isValidURL(text)) {
                      dropContainer.classList.add('hidden')
                      autoCopy.labels[0].classList.add('hidden')
                      progressBar.classList.remove('hidden')
                      fetch(`https://cors-anywhere.herokuapp.com/${text}`)
                      .then(response => response.blob())
                      .then(blob => {
                        if (blob.type.includes('image') || blob.type.includes('video') || blob.type.includes('audio')) {
                          blobs.push(blob)
                        }
                      })
                      .then(() => {
                        let fakeForm = new FormData()
                        if (blobs.length > 0) {
                          blobs.forEach(blob => {
                            fakeForm.append('file', blob, `${blob.name}`)
                          })
                          sendFiles(fakeForm)
                        }
                      })
                    }
                  })
                }
              }
              let fakeForm = new FormData()
              if (blobs.length > 0) {
                blobs.forEach(blob => {
                  fakeForm.append('file', blob, `${blob.name}`)
                })
                sendFiles(fakeForm)
              }
            }
          })
        })
      </script>
    -->
  </head>
  <body>
    <div id="content">
      <div id="logo">theshed<span>.red</span></div>
      <div id="dropzone">
        <span id="dropstate" class="idle">Click here or Dropfiles</span>
        <span id="progress" class="hidden invisible" data-progress="0">
          <span id="fill"></span>
          <span id="text">Uploading: 0%</span>
        </span>
      </div>
      <div id="buttons">
          <div id="uploadsBtn" class="button hidden">Uploads</div>
          <div id="settingsBtn" class="button">Settings</div>
      </div>
      <div id="settings" class="hidden invisible">
        <div class="setting">
          <span>Copy Link to Clipboard</span>
          <label class="switch">
            <input id="cltcb" type="checkbox" />
            <div class="slider round">
            </div>
          </label>
        </div>
        <div class="setting">
          <span>Direct Links for Images</span>
          <label class="switch">
            <input id="dlfi" type="checkbox" />
            <div class="slider round">
            </div>
          </label>
        </div>
        <div class="setting">
          <input type="text" id="ak" placeholder="Authorization Key"/>
        </div>
      </div>
      <input id="files" class="hidden" name="files" type="file" accept="image/*,video/*,audio/*" multiple />
    </div>
    <div id="footer">
      <a href="https://github.com/cmd430/TheShed.red">
        <svg viewBox="0 0 16 16" version="1.1">
          <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
        </svg>
      </a>
    </div>
  </body>
</html>